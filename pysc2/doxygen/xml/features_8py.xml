<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.14">
  <compounddef id="features_8py" kind="file" language="Python">
    <compoundname>features.py</compoundname>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_feature_type" prot="public">pysc2::lib::features::FeatureType</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_player_relative" prot="public">pysc2::lib::features::PlayerRelative</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_visibility" prot="public">pysc2::lib::features::Visibility</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_effects" prot="public">pysc2::lib::features::Effects</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_score_cumulative" prot="public">pysc2::lib::features::ScoreCumulative</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_player" prot="public">pysc2::lib::features::Player</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_unit_layer" prot="public">pysc2::lib::features::UnitLayer</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_feature_unit" prot="public">pysc2::lib::features::FeatureUnit</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_feature" prot="public">pysc2::lib::features::Feature</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_screen_features" prot="public">pysc2::lib::features::ScreenFeatures</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_minimap_features" prot="public">pysc2::lib::features::MinimapFeatures</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_dimensions" prot="public">pysc2::lib::features::Dimensions</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format" prot="public">pysc2::lib::features::AgentInterfaceFormat</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1features_1_1_features" prot="public">pysc2::lib::features::Features</innerclass>
    <innernamespace refid="namespacepysc2_1_1lib_1_1features">pysc2::lib::features</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacepysc2_1_1lib_1_1features" refkind="compound"><highlight class="comment">#<sp/>Copyright<sp/>2017<sp/>Google<sp/>Inc.<sp/>All<sp/>Rights<sp/>Reserved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Licensed<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the<sp/>&quot;License&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">#<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance<sp/>with<sp/>the<sp/>License.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">#<sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Unless<sp/>required<sp/>by<sp/>applicable<sp/>law<sp/>or<sp/>agreed<sp/>to<sp/>in<sp/>writing,<sp/>software</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">#<sp/>distributed<sp/>under<sp/>the<sp/>License<sp/>is<sp/>distributed<sp/>on<sp/>an<sp/>&quot;AS-IS&quot;<sp/>BASIS,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">#<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY<sp/>KIND,<sp/>either<sp/>express<sp/>or<sp/>implied.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">#<sp/>See<sp/>the<sp/>License<sp/>for<sp/>the<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">#<sp/>limitations<sp/>under<sp/>the<sp/>License.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="stringliteral">&quot;&quot;&quot;Render<sp/>feature<sp/>layers<sp/>from<sp/>SC2<sp/>Observation<sp/>protos<sp/>into<sp/>numpy<sp/>arrays.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>absolute_import</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>division</highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>print_function</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>collections</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>absl<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logging</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>enum</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>numpy<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>np</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>six</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacepysc2_1_1lib" kindref="compound">pysc2.lib</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>actions</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacepysc2_1_1lib" kindref="compound">pysc2.lib</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>colors</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacepysc2_1_1lib" kindref="compound">pysc2.lib</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>named_array</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacepysc2_1_1lib" kindref="compound">pysc2.lib</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>point</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacepysc2_1_1lib" kindref="compound">pysc2.lib</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>static_data</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacepysc2_1_1lib" kindref="compound">pysc2.lib</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>stopwatch</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacepysc2_1_1lib" kindref="compound">pysc2.lib</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>transform</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>s2clientprotocol<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>raw_pb2<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>sc_raw</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>s2clientprotocol<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sc2api_pb2<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>sc_pb</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal">sw<sp/>=<sp/>stopwatch.sw</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40" refid="classpysc2_1_1lib_1_1features_1_1_feature_type" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_feature_type" kindref="compound">FeatureType</ref>(enum.Enum):</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/>SCALAR<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/>CATEGORICAL<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45" refid="classpysc2_1_1lib_1_1features_1_1_player_relative" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_player_relative" kindref="compound">PlayerRelative</ref>(enum.IntEnum):</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;The<sp/>values<sp/>for<sp/>the<sp/>`player_relative`<sp/>feature<sp/>layers.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/>NONE<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/>SELF<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/>ALLY<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/>NEUTRAL<sp/>=<sp/>3</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/>ENEMY<sp/>=<sp/>4</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54" refid="classpysc2_1_1lib_1_1features_1_1_visibility" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_visibility" kindref="compound">Visibility</ref>(enum.IntEnum):</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Values<sp/>for<sp/>the<sp/>`visibility`<sp/>feature<sp/>layers.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/>HIDDEN<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/>SEEN<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/>VISIBLE<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61" refid="classpysc2_1_1lib_1_1features_1_1_effects" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_effects" kindref="compound">Effects</ref>(enum.IntEnum):</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Values<sp/>for<sp/>the<sp/>`effects`<sp/>feature<sp/>layer.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>pylint:<sp/>disable=invalid-name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/>PsiStorm<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/>GuardianShield<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/>TemporalFieldGrowing<sp/>=<sp/>3</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/>TemporalField<sp/>=<sp/>4</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/>ThermalLance<sp/>=<sp/>5</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/>ScannerSweep<sp/>=<sp/>6</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/>NukeDot<sp/>=<sp/>7</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/>LiberatorDefenderZoneSetup<sp/>=<sp/>8</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/>LiberatorDefenderZone<sp/>=<sp/>9</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/>BlindingCloud<sp/>=<sp/>10</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/>CorrosiveBile<sp/>=<sp/>11</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/>LurkerSpines<sp/>=<sp/>12</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>pylint:<sp/>enable=invalid-name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79" refid="classpysc2_1_1lib_1_1features_1_1_score_cumulative" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_score_cumulative" kindref="compound">ScoreCumulative</ref>(enum.IntEnum):</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Indices<sp/>into<sp/>the<sp/>`score_cumulative`<sp/>observation.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/>score<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/>idle_production_time<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/>idle_worker_time<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/>total_value_units<sp/>=<sp/>3</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/>total_value_structures<sp/>=<sp/>4</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/>killed_value_units<sp/>=<sp/>5</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/>killed_value_structures<sp/>=<sp/>6</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/>collected_minerals<sp/>=<sp/>7</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/>collected_vespene<sp/>=<sp/>8</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/>collection_rate_minerals<sp/>=<sp/>9</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/>collection_rate_vespene<sp/>=<sp/>10</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/>spent_minerals<sp/>=<sp/>11</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/>spent_vespene<sp/>=<sp/>12</highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96" refid="classpysc2_1_1lib_1_1features_1_1_player" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_player" kindref="compound">Player</ref>(enum.IntEnum):</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Indices<sp/>into<sp/>the<sp/>`player`<sp/>observation.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/>player_id<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/>minerals<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/>vespene<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/>food_used<sp/>=<sp/>3</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/>food_cap<sp/>=<sp/>4</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/>food_army<sp/>=<sp/>5</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/>food_workers<sp/>=<sp/>6</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/>idle_worker_count<sp/>=<sp/>7</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/>army_count<sp/>=<sp/>8</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/>warp_gate_count<sp/>=<sp/>9</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/>larva_count<sp/>=<sp/>10</highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111" refid="classpysc2_1_1lib_1_1features_1_1_unit_layer" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_unit_layer" kindref="compound">UnitLayer</ref>(enum.IntEnum):</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Indices<sp/>into<sp/>the<sp/>unit<sp/>layers<sp/>in<sp/>the<sp/>observations.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/>unit_type<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/>player_relative<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/>health<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>shields<sp/>=<sp/>3</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/>energy<sp/>=<sp/>4</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/>transport_slots_taken<sp/>=<sp/>5</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>build_progress<sp/>=<sp/>6</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122" refid="classpysc2_1_1lib_1_1features_1_1_feature_unit" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_feature_unit" kindref="compound">FeatureUnit</ref>(enum.IntEnum):</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Indices<sp/>for<sp/>the<sp/>`feature_unit`<sp/>observations.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/>unit_type<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/>alliance<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/>health<sp/>=<sp/>2</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/>shield<sp/>=<sp/>3</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/>energy<sp/>=<sp/>4</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/>cargo_space_taken<sp/>=<sp/>5</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/>build_progress<sp/>=<sp/>6</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/>health_ratio<sp/>=<sp/>7</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/>shield_ratio<sp/>=<sp/>8</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/>energy_ratio<sp/>=<sp/>9</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/>display_type<sp/>=<sp/>10</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/>owner<sp/>=<sp/>11</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/>x<sp/>=<sp/>12</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/>y<sp/>=<sp/>13</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/>facing<sp/>=<sp/>14</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/>radius<sp/>=<sp/>15</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/>cloak<sp/>=<sp/>16</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/>is_selected<sp/>=<sp/>17</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/>is_blip<sp/>=<sp/>18</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/>is_powered<sp/>=<sp/>19</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/>mineral_contents<sp/>=<sp/>20</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/>vespene_contents<sp/>=<sp/>21</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/>cargo_space_max<sp/>=<sp/>22</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/>assigned_harvesters<sp/>=<sp/>23</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/>ideal_harvesters<sp/>=<sp/>24</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/>weapon_cooldown<sp/>=<sp/>25</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_feature" kindref="compound">Feature</ref>(collections.namedtuple(</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Feature&quot;</highlight><highlight class="normal">,<sp/>[</highlight><highlight class="stringliteral">&quot;index&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;name&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;layer_set&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;full_name&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;scale&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;type&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="154" refid="classpysc2_1_1lib_1_1features_1_1_feature" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;palette&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;clip&quot;</highlight><highlight class="normal">])):</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Define<sp/>properties<sp/>of<sp/>a<sp/>feature<sp/>layer.</highlight></codeline>
<codeline lineno="156"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="157"><highlight class="stringliteral"><sp/><sp/>Attributes:</highlight></codeline>
<codeline lineno="158"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>index:<sp/>Index<sp/>of<sp/>this<sp/>layer<sp/>into<sp/>the<sp/>set<sp/>of<sp/>layers.</highlight></codeline>
<codeline lineno="159"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>name:<sp/>The<sp/>name<sp/>of<sp/>the<sp/>layer<sp/>within<sp/>the<sp/>set.</highlight></codeline>
<codeline lineno="160"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>layer_set:<sp/>Which<sp/>set<sp/>of<sp/>feature<sp/>layers<sp/>to<sp/>look<sp/>at<sp/>in<sp/>the<sp/>observation<sp/>proto.</highlight></codeline>
<codeline lineno="161"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>full_name:<sp/>The<sp/>full<sp/>name<sp/>including<sp/>for<sp/>visualization.</highlight></codeline>
<codeline lineno="162"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>scale:<sp/>Max<sp/>value<sp/>(+1)<sp/>of<sp/>this<sp/>layer,<sp/>used<sp/>to<sp/>scale<sp/>the<sp/>values.</highlight></codeline>
<codeline lineno="163"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>type:<sp/>A<sp/>FeatureType<sp/>for<sp/>scalar<sp/>vs<sp/>categorical.</highlight></codeline>
<codeline lineno="164"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>palette:<sp/>A<sp/>color<sp/>palette<sp/>for<sp/>rendering.</highlight></codeline>
<codeline lineno="165"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>clip:<sp/>Whether<sp/>to<sp/>clip<sp/>the<sp/>values<sp/>for<sp/>coloring.</highlight></codeline>
<codeline lineno="166"><highlight class="stringliteral"><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/>__slots__<sp/>=<sp/>()</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/>dtypes<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>1:<sp/>np.uint8,</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>8:<sp/>np.uint8,</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>16:<sp/>np.uint16,</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>32:<sp/>np.int32,</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_feature_1a840859c8cc0f2bc3c80b665a38e879d7" kindref="member">unpack</ref>(self,<sp/>obs):</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>a<sp/>correctly<sp/>shaped<sp/>numpy<sp/>array<sp/>for<sp/>this<sp/>feature.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/>planes<sp/>=<sp/>getattr(obs.feature_layer_data,<sp/>self.layer_set)</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>plane<sp/>=<sp/>getattr(planes,<sp/>self.name)</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_feature_1ae2deeb3c743654425193f0b225c388e8" kindref="member">unpack_layer</ref>(plane)</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/>@staticmethod</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_feature_1ae2deeb3c743654425193f0b225c388e8" kindref="member">unpack_layer</ref>(plane):</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>a<sp/>correctly<sp/>shaped<sp/>numpy<sp/>array<sp/>given<sp/>the<sp/>feature<sp/>layer<sp/>bytes.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/>size<sp/>=<sp/>point.Point.build(plane.size)</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>size<sp/>==<sp/>(0,<sp/>0):</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>New<sp/>layer<sp/>that<sp/>isn&apos;t<sp/>implemented<sp/>in<sp/>this<sp/>SC2<sp/>version.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>data<sp/>=<sp/>np.frombuffer(plane.data,<sp/>dtype=Feature.dtypes[plane.bits_per_pixel])</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>plane.bits_per_pixel<sp/>==<sp/>1:</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>np.unpackbits(data)</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>data.shape[0]<sp/>!=<sp/>size.x<sp/>*<sp/>size.y:</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>This<sp/>could<sp/>happen<sp/>if<sp/>the<sp/>correct<sp/>length<sp/>isn&apos;t<sp/>a<sp/>multiple<sp/>of<sp/>8,<sp/>leading</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>to<sp/>some<sp/>padding<sp/>bits<sp/>at<sp/>the<sp/>end<sp/>of<sp/>the<sp/>string<sp/>which<sp/>are<sp/>incorrectly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>interpreted<sp/>as<sp/>data.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>data[:size.x<sp/>*<sp/>size.y]</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data.reshape(size.y,<sp/>size.x)</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/>@staticmethod</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_feature_1addc5dd18d59ef32762876df736f4509d" kindref="member">unpack_rgb_image</ref>(plane):</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>a<sp/>correctly<sp/>shaped<sp/>numpy<sp/>array<sp/>given<sp/>the<sp/>image<sp/>bytes.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>plane.bits_per_pixel<sp/>==<sp/>24,<sp/></highlight><highlight class="stringliteral">&quot;{}<sp/>!=<sp/>24&quot;</highlight><highlight class="normal">.format(plane.bits_per_pixel)</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>size<sp/>=<sp/>point.Point.build(plane.size)</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>data<sp/>=<sp/>np.frombuffer(plane.data,<sp/>dtype=np.uint8)</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data.reshape(size.y,<sp/>size.x,<sp/>3)</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_feature_1a08f6ecbdfc49803c7221b5948d91df9e" kindref="member">color</ref>(self,<sp/>plane):</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.clip:</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>plane<sp/>=<sp/>np.clip(plane,<sp/>0,<sp/>self.scale<sp/>-<sp/>1)</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.palette[plane]</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_screen_features" kindref="compound">ScreenFeatures</ref>(collections.namedtuple(</highlight><highlight class="stringliteral">&quot;ScreenFeatures&quot;</highlight><highlight class="normal">,<sp/>[</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;height_map&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;visibility_map&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;creep&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;power&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;player_id&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;player_relative&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;unit_type&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;selected&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;unit_hit_points&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;unit_hit_points_ratio&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;unit_energy&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;unit_energy_ratio&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;unit_shields&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="220" refid="classpysc2_1_1lib_1_1features_1_1_screen_features" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;unit_shields_ratio&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;unit_density&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;unit_density_aa&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;effects&quot;</highlight><highlight class="normal">])):</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;The<sp/>set<sp/>of<sp/>screen<sp/>feature<sp/>layers.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/>__slots__<sp/>=<sp/>()</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_screen_features_1a30f47c7db2836974eb515784b1efe33b" kindref="member">__new__</ref>(cls,<sp/>**kwargs):</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>feats<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>name,<sp/>(scale,<sp/>type_,<sp/>palette,<sp/>clip)<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>six.iteritems(kwargs):</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>feats[name]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_feature" kindref="compound">Feature</ref>(</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index=ScreenFeatures._fields.index(name),</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name=name,</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer_set=</highlight><highlight class="stringliteral">&quot;renders&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_name=</highlight><highlight class="stringliteral">&quot;screen<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>name,</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scale=scale,</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>type=type_,</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>palette=palette(scale)<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>callable(palette)<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>palette,</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clip=clip)</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>super(ScreenFeatures,<sp/>cls).<ref refid="classpysc2_1_1lib_1_1features_1_1_screen_features_1a30f47c7db2836974eb515784b1efe33b" kindref="member">__new__</ref>(cls,<sp/>**feats)<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=missing-parameter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_minimap_features" kindref="compound">MinimapFeatures</ref>(collections.namedtuple(</highlight><highlight class="stringliteral">&quot;MinimapFeatures&quot;</highlight><highlight class="normal">,<sp/>[</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;height_map&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;visibility_map&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;creep&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;camera&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;player_id&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="241" refid="classpysc2_1_1lib_1_1features_1_1_minimap_features" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;player_relative&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;selected&quot;</highlight><highlight class="normal">])):</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;The<sp/>set<sp/>of<sp/>minimap<sp/>feature<sp/>layers.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/>__slots__<sp/>=<sp/>()</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_minimap_features_1a1f02bf52fac52f980a4f09afbbe34731" kindref="member">__new__</ref>(cls,<sp/>**kwargs):</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>feats<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>name,<sp/>(scale,<sp/>type_,<sp/>palette)<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>six.iteritems(kwargs):</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>feats[name]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_feature" kindref="compound">Feature</ref>(</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index=MinimapFeatures._fields.index(name),</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name=name,</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>layer_set=</highlight><highlight class="stringliteral">&quot;minimap_renders&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>full_name=</highlight><highlight class="stringliteral">&quot;minimap<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>name,</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scale=scale,</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>type=type_,</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>palette=palette(scale)<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>callable(palette)<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>palette,</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clip=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>super(MinimapFeatures,<sp/>cls).<ref refid="classpysc2_1_1lib_1_1features_1_1_minimap_features_1a1f02bf52fac52f980a4f09afbbe34731" kindref="member">__new__</ref>(cls,<sp/>**feats)<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=missing-parameter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal">SCREEN_FEATURES<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_screen_features" kindref="compound">ScreenFeatures</ref>(</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>height_map=(256,<sp/>FeatureType.SCALAR,<sp/>colors.winter,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>visibility_map=(4,<sp/>FeatureType.CATEGORICAL,</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>colors.VISIBILITY_PALETTE,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/>creep=(2,<sp/>FeatureType.CATEGORICAL,<sp/>colors.CREEP_PALETTE,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/>power=(2,<sp/>FeatureType.CATEGORICAL,<sp/>colors.POWER_PALETTE,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>player_id=(17,<sp/>FeatureType.CATEGORICAL,</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>colors.PLAYER_ABSOLUTE_PALETTE,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>player_relative=(5,<sp/>FeatureType.CATEGORICAL,</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>colors.PLAYER_RELATIVE_PALETTE,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_type=(max(static_data.UNIT_TYPES)<sp/>+<sp/>1,<sp/>FeatureType.CATEGORICAL,</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>colors.unit_type,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>selected=(2,<sp/>FeatureType.CATEGORICAL,<sp/>colors.SELECTED_PALETTE,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_hit_points=(1600,<sp/>FeatureType.SCALAR,<sp/>colors.hot,<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_hit_points_ratio=(256,<sp/>FeatureType.SCALAR,<sp/>colors.hot,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_energy=(1000,<sp/>FeatureType.SCALAR,<sp/>colors.hot,<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_energy_ratio=(256,<sp/>FeatureType.SCALAR,<sp/>colors.hot,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_shields=(1000,<sp/>FeatureType.SCALAR,<sp/>colors.hot,<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_shields_ratio=(256,<sp/>FeatureType.SCALAR,<sp/>colors.hot,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_density=(16,<sp/>FeatureType.SCALAR,<sp/>colors.hot,<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/>unit_density_aa=(256,<sp/>FeatureType.SCALAR,<sp/>colors.hot,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>effects=(16,<sp/>FeatureType.CATEGORICAL,<sp/>colors.effects,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="282"><highlight class="normal">)</highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal">MINIMAP_FEATURES<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_minimap_features" kindref="compound">MinimapFeatures</ref>(</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/>height_map=(256,<sp/>FeatureType.SCALAR,<sp/>colors.winter),</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>visibility_map=(4,<sp/>FeatureType.CATEGORICAL,<sp/>colors.VISIBILITY_PALETTE),</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>creep=(2,<sp/>FeatureType.CATEGORICAL,<sp/>colors.CREEP_PALETTE),</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/>camera=(2,<sp/>FeatureType.CATEGORICAL,<sp/>colors.CAMERA_PALETTE),</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/>player_id=(17,<sp/>FeatureType.CATEGORICAL,<sp/>colors.PLAYER_ABSOLUTE_PALETTE),</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>player_relative=(5,<sp/>FeatureType.CATEGORICAL,</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>colors.PLAYER_RELATIVE_PALETTE),</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/>selected=(2,<sp/>FeatureType.CATEGORICAL,<sp/>colors.winter),</highlight></codeline>
<codeline lineno="293"><highlight class="normal">)</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_to_point(dims):</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Convert<sp/>(width,<sp/>height)<sp/>or<sp/>size<sp/>-&gt;<sp/>point.Point.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>dims</highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>isinstance(dims,<sp/>(tuple,<sp/>list)):</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(dims)<sp/>!=<sp/>2:</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;A<sp/>two<sp/>element<sp/>tuple<sp/>or<sp/>list<sp/>is<sp/>expected<sp/>here,<sp/>got<sp/>{}.&quot;</highlight><highlight class="normal">.format(dims))</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>width<sp/>=<sp/>int(dims[0])</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>height<sp/>=<sp/>int(dims[1])</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>width<sp/>&lt;=<sp/>0<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>height<sp/>&lt;=<sp/>0:</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Must<sp/>specify<sp/>+ve<sp/>dims,<sp/>got<sp/>{}.&quot;</highlight><highlight class="normal">.format(dims))</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1point_1_1_point" kindref="compound">point.Point</ref>(width,<sp/>height)</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>size<sp/>=<sp/>int(dims)</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>size<sp/>&lt;=<sp/>0:</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Must<sp/>specify<sp/>a<sp/>+ve<sp/>value<sp/>for<sp/>size,<sp/>got<sp/>{}.&quot;</highlight><highlight class="normal">.format(dims))</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1point_1_1_point" kindref="compound">point.Point</ref>(size,<sp/>size)</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320" refid="classpysc2_1_1lib_1_1features_1_1_dimensions" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions" kindref="compound">Dimensions</ref>(object):</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Screen<sp/>and<sp/>minimap<sp/>dimensions<sp/>configuration.</highlight></codeline>
<codeline lineno="322"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="323"><highlight class="stringliteral"><sp/><sp/>Both<sp/>screen<sp/>and<sp/>minimap<sp/>must<sp/>be<sp/>specified.<sp/>Sizes<sp/>must<sp/>be<sp/>positive.</highlight></codeline>
<codeline lineno="324"><highlight class="stringliteral"><sp/><sp/>Screen<sp/>size<sp/>must<sp/>be<sp/>greater<sp/>than<sp/>or<sp/>equal<sp/>to<sp/>minimap<sp/>size<sp/>in<sp/>both<sp/>dimensions.</highlight></codeline>
<codeline lineno="325"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="326"><highlight class="stringliteral"><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="327"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>screen:<sp/>A<sp/>(width,<sp/>height)<sp/>int<sp/>tuple<sp/>or<sp/>a<sp/>single<sp/>int<sp/>to<sp/>be<sp/>used<sp/>for<sp/>both.</highlight></codeline>
<codeline lineno="328"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>minimap:<sp/>A<sp/>(width,<sp/>height)<sp/>int<sp/>tuple<sp/>or<sp/>a<sp/>single<sp/>int<sp/>to<sp/>be<sp/>used<sp/>for<sp/>both.</highlight></codeline>
<codeline lineno="329"><highlight class="stringliteral"><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a1baec57f9a7f019d9c9147e10473a15e" kindref="member">__init__</ref>(self,<sp/>screen=None,<sp/>minimap=None):</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>screen<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>minimap:</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;screen<sp/>and<sp/>minimap<sp/>must<sp/>both<sp/>be<sp/>set,<sp/>screen={},<sp/>minimap={}&quot;</highlight><highlight class="normal">.format(</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>screen,<sp/>minimap))</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a4c84e2ab76ea9a29f995d1bfb5087285" kindref="member">_screen</ref><sp/>=<sp/>_to_point(screen)</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1afbe7dda3af377c100d0f810990cbebb1" kindref="member">_minimap</ref><sp/>=<sp/>_to_point(minimap)</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a4c84e2ab76ea9a29f995d1bfb5087285" kindref="member">_screen</ref>.x<sp/>&lt;<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1afbe7dda3af377c100d0f810990cbebb1" kindref="member">_minimap</ref>.x<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a4c84e2ab76ea9a29f995d1bfb5087285" kindref="member">_screen</ref>.y<sp/>&lt;<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1afbe7dda3af377c100d0f810990cbebb1" kindref="member">_minimap</ref>.y:</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Screen<sp/>(%s)<sp/>can&apos;t<sp/>be<sp/>smaller<sp/>than<sp/>the<sp/>minimap<sp/>(%s).&quot;</highlight><highlight class="normal"><sp/>%<sp/>(</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a4c84e2ab76ea9a29f995d1bfb5087285" kindref="member">_screen</ref>,<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1afbe7dda3af377c100d0f810990cbebb1" kindref="member">_minimap</ref>))</highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a8f2a12331c6acb2070a3cd77ce4019f0" kindref="member">screen</ref>(self):</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a4c84e2ab76ea9a29f995d1bfb5087285" kindref="member">_screen</ref></highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1ac3367e0b221b72b66beb5f5b1d5a1169" kindref="member">minimap</ref>(self):</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1afbe7dda3af377c100d0f810990cbebb1" kindref="member">_minimap</ref></highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a8e72e9bec4a76d1f91ecdf0523991cae" kindref="member">__repr__</ref>(self):</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Dimensions(screen={},<sp/>minimap={})&quot;</highlight><highlight class="normal">.format(self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1a8f2a12331c6acb2070a3cd77ce4019f0" kindref="member">screen</ref>,<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions_1ac3367e0b221b72b66beb5f5b1d5a1169" kindref="member">minimap</ref>)</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight></codeline>
<codeline lineno="357" refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format" kindref="compound">AgentInterfaceFormat</ref>(object):</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Observation<sp/>and<sp/>action<sp/>interface<sp/>format<sp/>specific<sp/>to<sp/>a<sp/>particular<sp/>agent.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a80c173fac4f02ee090925b0ba2eaa369" kindref="member">__init__</ref>(</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>feature_dimensions=None,</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rgb_dimensions=None,</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>action_space=None,</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>camera_width_world_units=None,</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>use_feature_units=False,</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>hide_specific_actions=True):</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Initializer.</highlight></codeline>
<codeline lineno="369"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="370"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="371"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>feature_dimensions:<sp/>Feature<sp/>layer<sp/>`Dimension`s.<sp/>Either<sp/>this<sp/>or</highlight></codeline>
<codeline lineno="372"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rgb_dimensions<sp/>(or<sp/>both)<sp/>must<sp/>be<sp/>set.</highlight></codeline>
<codeline lineno="373"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>rgb_dimensions:<sp/>RGB<sp/>`Dimension`.<sp/>Either<sp/>this<sp/>or<sp/>feature_dimensions</highlight></codeline>
<codeline lineno="374"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(or<sp/>both)<sp/>must<sp/>be<sp/>set.</highlight></codeline>
<codeline lineno="375"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>action_space:<sp/>If<sp/>you<sp/>pass<sp/>both<sp/>feature<sp/>and<sp/>rgb<sp/>sizes,<sp/>then<sp/>you<sp/>must<sp/>also</highlight></codeline>
<codeline lineno="376"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specify<sp/>which<sp/>you<sp/>want<sp/>to<sp/>use<sp/>for<sp/>your<sp/>actions<sp/>as<sp/>an<sp/>ActionSpace<sp/>enum.</highlight></codeline>
<codeline lineno="377"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>camera_width_world_units:<sp/>The<sp/>width<sp/>of<sp/>your<sp/>screen<sp/>in<sp/>world<sp/>units.<sp/>If<sp/>your</highlight></codeline>
<codeline lineno="378"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>feature_dimensions.screen=(64,<sp/>48)<sp/>and<sp/>camera_width<sp/>is<sp/>24,<sp/>then<sp/>each</highlight></codeline>
<codeline lineno="379"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>px<sp/>represents<sp/>24<sp/>/<sp/>64<sp/>=<sp/>0.375<sp/>world<sp/>units<sp/>in<sp/>each<sp/>of<sp/>x<sp/>and<sp/>y.</highlight></codeline>
<codeline lineno="380"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>It&apos;ll<sp/>then<sp/>represent<sp/>a<sp/>camera<sp/>of<sp/>size<sp/>(24,<sp/>0.375<sp/>*<sp/>48)<sp/>=<sp/>(24,<sp/>18)</highlight></codeline>
<codeline lineno="381"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>world<sp/>units.</highlight></codeline>
<codeline lineno="382"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>use_feature_units:<sp/>Whether<sp/>to<sp/>include<sp/>feature<sp/>unit<sp/>data<sp/>in<sp/>observations.</highlight></codeline>
<codeline lineno="383"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>hide_specific_actions:<sp/>[bool]<sp/>Some<sp/>actions<sp/>(eg<sp/>cancel)<sp/>have<sp/>many</highlight></codeline>
<codeline lineno="384"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specific<sp/>versions<sp/>(cancel<sp/>this<sp/>building,<sp/>cancel<sp/>that<sp/>spell)<sp/>and<sp/>can</highlight></codeline>
<codeline lineno="385"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>be<sp/>represented<sp/>in<sp/>a<sp/>more<sp/>general<sp/>form.<sp/>If<sp/>a<sp/>specific<sp/>action<sp/>is</highlight></codeline>
<codeline lineno="386"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>available,<sp/>the<sp/>general<sp/>will<sp/>also<sp/>be<sp/>available.<sp/>If<sp/>you<sp/>set</highlight></codeline>
<codeline lineno="387"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>`hide_specific_actions`<sp/>to<sp/>False,<sp/>the<sp/>specific<sp/>versions<sp/>will<sp/>also<sp/>be</highlight></codeline>
<codeline lineno="388"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>available,<sp/>but<sp/>if<sp/>it&apos;s<sp/>True,<sp/>the<sp/>specific<sp/>ones<sp/>will<sp/>be<sp/>hidden.</highlight></codeline>
<codeline lineno="389"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Similarly,<sp/>when<sp/>transforming<sp/>back,<sp/>a<sp/>specific<sp/>action<sp/>will<sp/>be<sp/>returned</highlight></codeline>
<codeline lineno="390"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>the<sp/>general<sp/>action.<sp/>This<sp/>simplifies<sp/>the<sp/>action<sp/>space,<sp/>though<sp/>can</highlight></codeline>
<codeline lineno="391"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lead<sp/>to<sp/>some<sp/>actions<sp/>in<sp/>replays<sp/>not<sp/>being<sp/>exactly<sp/>representable<sp/>using</highlight></codeline>
<codeline lineno="392"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>only<sp/>the<sp/>general<sp/>actions.</highlight></codeline>
<codeline lineno="393"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="394"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Raises:</highlight></codeline>
<codeline lineno="395"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ValueError:<sp/>if<sp/>the<sp/>parameters<sp/>are<sp/>inconsistent.</highlight></codeline>
<codeline lineno="396"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>feature_dimensions<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>rgb_dimensions:</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Must<sp/>set<sp/>either<sp/>the<sp/>feature<sp/>layer<sp/>or<sp/>rgb<sp/>dimensions.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>action_space:</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>isinstance(action_space,<sp/><ref refid="classpysc2_1_1lib_1_1actions_1_1_action_space" kindref="compound">actions.ActionSpace</ref>):</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;action_space<sp/>must<sp/>be<sp/>of<sp/>type<sp/>ActionSpace.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((action_space<sp/>==<sp/>actions.ActionSpace.FEATURES<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>feature_dimensions)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(action_space<sp/>==<sp/>actions.ActionSpace.RGB<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>rgb_dimensions)):</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Action<sp/>space<sp/>must<sp/>match<sp/>the<sp/>observations,<sp/>action<sp/>space={},<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;feature_dimensions={},<sp/>rgb_dimensions={}&quot;</highlight><highlight class="normal">.format(</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>action_space,<sp/>feature_dimensions,<sp/>rgb_dimensions))</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>feature_dimensions<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>rgb_dimensions:</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;You<sp/>must<sp/>specify<sp/>the<sp/>action<sp/>space<sp/>if<sp/>you<sp/>have<sp/>both<sp/>screen<sp/>and<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;rgb<sp/>observations.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>feature_dimensions:</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>action_space<sp/>=<sp/>actions.ActionSpace.FEATURES</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>action_space<sp/>=<sp/>actions.ActionSpace.RGB</highlight></codeline>
<codeline lineno="422"><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1aeda01352e50b49c7334d7955caa8496a" kindref="member">_feature_dimensions</ref><sp/>=<sp/>feature_dimensions</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1aeffb735f0777456cdc13ddb70138d06e" kindref="member">_rgb_dimensions</ref><sp/>=<sp/>rgb_dimensions</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a3790a07688bcbfc791e0862d1e911689" kindref="member">_action_space</ref><sp/>=<sp/>action_space</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a666751de23eeb972022ca3308652df0e" kindref="member">_camera_width_world_units</ref><sp/>=<sp/>camera_width_world_units<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>24</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a00fe1d4201b1841dcf3312c52b7b48da" kindref="member">_use_feature_units</ref><sp/>=<sp/>use_feature_units</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1ad5d9cd038cc90eba5b66e5ebae632cb2" kindref="member">_hide_specific_actions</ref><sp/>=<sp/>hide_specific_actions</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>action_space<sp/>==<sp/>actions.ActionSpace.FEATURES:</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a422bdf9a3834a3aa2bace7b3f6f1f721" kindref="member">_action_dimensions</ref><sp/>=<sp/>feature_dimensions</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a422bdf9a3834a3aa2bace7b3f6f1f721" kindref="member">_action_dimensions</ref><sp/>=<sp/>rgb_dimensions</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1afb6336f68b4dd6a550a8483e59d8bf31" kindref="member">feature_dimensions</ref>(self):</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1aeda01352e50b49c7334d7955caa8496a" kindref="member">_feature_dimensions</ref></highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a5531c5661ecd91f244bf3f9598d22d67" kindref="member">rgb_dimensions</ref>(self):</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1aeffb735f0777456cdc13ddb70138d06e" kindref="member">_rgb_dimensions</ref></highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1aebb7cd1ed5816051abe21703184cc16a" kindref="member">action_space</ref>(self):</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a3790a07688bcbfc791e0862d1e911689" kindref="member">_action_space</ref></highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a5140a9024f2fb47046074e511acd0dd0" kindref="member">camera_width_world_units</ref>(self):</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a666751de23eeb972022ca3308652df0e" kindref="member">_camera_width_world_units</ref></highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1abac891fe53cafd4798d13ca70db971f5" kindref="member">use_feature_units</ref>(self):</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a00fe1d4201b1841dcf3312c52b7b48da" kindref="member">_use_feature_units</ref></highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1adbc6be15eae7945c226758c1bc666443" kindref="member">hide_specific_actions</ref>(self):</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1ad5d9cd038cc90eba5b66e5ebae632cb2" kindref="member">_hide_specific_actions</ref></highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a8fa5a036defb7844b94946a505e28148" kindref="member">action_dimensions</ref>(self):</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format_1a422bdf9a3834a3aa2bace7b3f6f1f721" kindref="member">_action_dimensions</ref></highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacepysc2_1_1lib_1_1features_1a5075b8a72e7dbe879edda0d3dbe902fe" kindref="member">parse_agent_interface_format</ref>(</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/>feature_screen=None,</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/>feature_minimap=None,</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>rgb_screen=None,</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/>rgb_minimap=None,</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/>action_space=None,</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/>camera_width_world_units=None,</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/>use_feature_units=False):</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Creates<sp/>an<sp/>AgentInterfaceFormat<sp/>object<sp/>from<sp/>keyword<sp/>args.</highlight></codeline>
<codeline lineno="473"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="474"><highlight class="stringliteral"><sp/><sp/>Convenient<sp/>when<sp/>using<sp/>dictionaries<sp/>or<sp/>command-line<sp/>arguments<sp/>for<sp/>config.</highlight></codeline>
<codeline lineno="475"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="476"><highlight class="stringliteral"><sp/><sp/>Note<sp/>that<sp/>the<sp/>feature_*<sp/>and<sp/>rgb_*<sp/>properties<sp/>define<sp/>the<sp/>respective<sp/>spatial</highlight></codeline>
<codeline lineno="477"><highlight class="stringliteral"><sp/><sp/>observation<sp/>dimensions<sp/>and<sp/>accept:</highlight></codeline>
<codeline lineno="478"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>None<sp/>or<sp/>0<sp/>to<sp/>disable<sp/>that<sp/>spatial<sp/>observation.</highlight></codeline>
<codeline lineno="479"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>A<sp/>single<sp/>int<sp/>for<sp/>a<sp/>square<sp/>observation<sp/>with<sp/>that<sp/>side<sp/>length.</highlight></codeline>
<codeline lineno="480"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>A<sp/>(int,<sp/>int)<sp/>tuple<sp/>for<sp/>a<sp/>rectangular<sp/>(width,<sp/>height)<sp/>observation.</highlight></codeline>
<codeline lineno="481"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="482"><highlight class="stringliteral"><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="483"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>feature_screen:<sp/>If<sp/>specified,<sp/>so<sp/>must<sp/>feature_minimap<sp/>be.</highlight></codeline>
<codeline lineno="484"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>feature_minimap:<sp/>If<sp/>specified,<sp/>so<sp/>must<sp/>feature_screen<sp/>be.</highlight></codeline>
<codeline lineno="485"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>rgb_screen:<sp/>If<sp/>specified,<sp/>so<sp/>must<sp/>rgb_minimap<sp/>be.</highlight></codeline>
<codeline lineno="486"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>rgb_minimap:<sp/>If<sp/>specified,<sp/>so<sp/>must<sp/>rgb_screen<sp/>be.</highlight></codeline>
<codeline lineno="487"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>action_space:<sp/>[&quot;FEATURES&quot;,<sp/>&quot;RGB&quot;].</highlight></codeline>
<codeline lineno="488"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>camera_width_world_units:<sp/>An<sp/>int.</highlight></codeline>
<codeline lineno="489"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>use_feature_units:<sp/>A<sp/>boolean,<sp/>defaults<sp/>to<sp/>False.</highlight></codeline>
<codeline lineno="490"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="491"><highlight class="stringliteral"><sp/><sp/>Returns:</highlight></codeline>
<codeline lineno="492"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>An<sp/>`AgentInterfaceFormat`<sp/>object.</highlight></codeline>
<codeline lineno="493"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="494"><highlight class="stringliteral"><sp/><sp/>Raises:</highlight></codeline>
<codeline lineno="495"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>ValueError:<sp/>If<sp/>an<sp/>invalid<sp/>parameter<sp/>is<sp/>specified.</highlight></codeline>
<codeline lineno="496"><highlight class="stringliteral"><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>feature_screen<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>feature_minimap:</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/>feature_dimensions<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions" kindref="compound">Dimensions</ref>(</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>screen=feature_screen,</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minimap=feature_minimap)</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/>feature_dimensions<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>rgb_screen<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>rgb_minimap:</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/>rgb_dimensions<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions" kindref="compound">Dimensions</ref>(</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>screen=rgb_screen,</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minimap=rgb_minimap)</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/>rgb_dimensions<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format" kindref="compound">AgentInterfaceFormat</ref>(</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>feature_dimensions=feature_dimensions,</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rgb_dimensions=rgb_dimensions,</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>action_space=(action_space<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1actions_1_1_action_space" kindref="compound">actions.ActionSpace</ref>[action_space.upper()]),</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>camera_width_world_units=camera_width_world_units,</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>use_feature_units=use_feature_units</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/>)</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacepysc2_1_1lib_1_1features_1a633aa1ab712129e68a37ec8e7ddbef10" kindref="member">features_from_game_info</ref>(</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/>game_info,</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>use_feature_units=False,</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>action_space=None,</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/>hide_specific_actions=True):</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Construct<sp/>a<sp/>Features<sp/>object<sp/>using<sp/>data<sp/>extracted<sp/>from<sp/>game<sp/>info.</highlight></codeline>
<codeline lineno="526"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="527"><highlight class="stringliteral"><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="528"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>game_info:<sp/>A<sp/>`sc_pb.ResponseGameInfo`<sp/>from<sp/>the<sp/>game.</highlight></codeline>
<codeline lineno="529"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>use_feature_units:<sp/>Whether<sp/>to<sp/>include<sp/>the<sp/>feature<sp/>unit<sp/>observation.</highlight></codeline>
<codeline lineno="530"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>action_space:<sp/>If<sp/>you<sp/>pass<sp/>both<sp/>feature<sp/>and<sp/>rgb<sp/>sizes,<sp/>then<sp/>you<sp/>must<sp/>also</highlight></codeline>
<codeline lineno="531"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specify<sp/>which<sp/>you<sp/>want<sp/>to<sp/>use<sp/>for<sp/>your<sp/>actions<sp/>as<sp/>an<sp/>ActionSpace<sp/>enum.</highlight></codeline>
<codeline lineno="532"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>hide_specific_actions:<sp/>[bool]<sp/>Some<sp/>actions<sp/>(eg<sp/>cancel)<sp/>have<sp/>many</highlight></codeline>
<codeline lineno="533"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specific<sp/>versions<sp/>(cancel<sp/>this<sp/>building,<sp/>cancel<sp/>that<sp/>spell)<sp/>and<sp/>can</highlight></codeline>
<codeline lineno="534"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>be<sp/>represented<sp/>in<sp/>a<sp/>more<sp/>general<sp/>form.<sp/>If<sp/>a<sp/>specific<sp/>action<sp/>is</highlight></codeline>
<codeline lineno="535"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>available,<sp/>the<sp/>general<sp/>will<sp/>also<sp/>be<sp/>available.<sp/>If<sp/>you<sp/>set</highlight></codeline>
<codeline lineno="536"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>`hide_specific_actions`<sp/>to<sp/>False,<sp/>the<sp/>specific<sp/>versions<sp/>will<sp/>also<sp/>be</highlight></codeline>
<codeline lineno="537"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>available,<sp/>but<sp/>if<sp/>it&apos;s<sp/>True,<sp/>the<sp/>specific<sp/>ones<sp/>will<sp/>be<sp/>hidden.</highlight></codeline>
<codeline lineno="538"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Similarly,<sp/>when<sp/>transforming<sp/>back,<sp/>a<sp/>specific<sp/>action<sp/>will<sp/>be<sp/>returned</highlight></codeline>
<codeline lineno="539"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>the<sp/>general<sp/>action.<sp/>This<sp/>simplifies<sp/>the<sp/>action<sp/>space,<sp/>though<sp/>can</highlight></codeline>
<codeline lineno="540"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lead<sp/>to<sp/>some<sp/>actions<sp/>in<sp/>replays<sp/>not<sp/>being<sp/>exactly<sp/>representable<sp/>using</highlight></codeline>
<codeline lineno="541"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>only<sp/>the<sp/>general<sp/>actions.</highlight></codeline>
<codeline lineno="542"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="543"><highlight class="stringliteral"><sp/><sp/>Returns:</highlight></codeline>
<codeline lineno="544"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>A<sp/>features<sp/>object<sp/>matching<sp/>the<sp/>specified<sp/>parameterisation.</highlight></codeline>
<codeline lineno="545"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="546"><highlight class="stringliteral"><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>game_info.options.HasField(</highlight><highlight class="stringliteral">&quot;feature_layer&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/>fl_opts<sp/>=<sp/>game_info.options.feature_layer</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/>feature_dimensions<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions" kindref="compound">Dimensions</ref>(</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>screen=(fl_opts.resolution.x,<sp/>fl_opts.resolution.y),</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minimap=(fl_opts.minimap_resolution.x,<sp/>fl_opts.minimap_resolution.y))</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/>feature_dimensions<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>game_info.options.HasField(</highlight><highlight class="stringliteral">&quot;render&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/>rgb_opts<sp/>=<sp/>game_info.options.render</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/>rgb_dimensions<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_dimensions" kindref="compound">Dimensions</ref>(</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>screen=(rgb_opts.resolution.x,<sp/>rgb_opts.resolution.y),</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minimap=(rgb_opts.minimap_resolution.x,<sp/>rgb_opts.minimap_resolution.y))</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/>rgb_dimensions<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/>map_size<sp/>=<sp/>game_info.start_raw.map_size</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/>camera_width_world_units<sp/>=<sp/>game_info.options.feature_layer.width</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1features_1_1_features" kindref="compound">Features</ref>(</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>agent_interface_format=<ref refid="classpysc2_1_1lib_1_1features_1_1_agent_interface_format" kindref="compound">AgentInterfaceFormat</ref>(</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>feature_dimensions=feature_dimensions,</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rgb_dimensions=rgb_dimensions,</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>use_feature_units=use_feature_units,</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>camera_width_world_units=camera_width_world_units,</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>action_space=action_space,</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hide_specific_actions=hide_specific_actions),</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>map_size=map_size)</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_init_valid_functions(action_dimensions):</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Initialize<sp/>ValidFunctions<sp/>and<sp/>set<sp/>up<sp/>the<sp/>callbacks.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/>sizes<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;screen&quot;</highlight><highlight class="normal">:<sp/>tuple(int(i)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>action_dimensions.screen),</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;screen2&quot;</highlight><highlight class="normal">:<sp/>tuple(int(i)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>action_dimensions.screen),</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;minimap&quot;</highlight><highlight class="normal">:<sp/>tuple(int(i)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>action_dimensions.minimap),</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="585"><highlight class="normal"></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/>types<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1actions_1_1_arguments" kindref="compound">actions.Arguments</ref>(*[</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>actions.ArgumentType.spec(t.id,<sp/>t.name,<sp/>sizes.get(t.name,<sp/>t.sizes))</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>t<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>actions.TYPES])</highlight></codeline>
<codeline lineno="589"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/>functions<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1actions_1_1_functions" kindref="compound">actions.Functions</ref>([</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>actions.Function.spec(f.id,<sp/>f.name,<sp/>tuple(types[t.id]<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>t<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>f.args))</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>f<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>actions.FUNCTIONS])</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1actions_1_1_valid_actions" kindref="compound">actions.ValidActions</ref>(types,<sp/>functions)</highlight></codeline>
<codeline lineno="595"><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597" refid="classpysc2_1_1lib_1_1features_1_1_features" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_features" kindref="compound">Features</ref>(object):</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Render<sp/>feature<sp/>layers<sp/>from<sp/>SC2<sp/>Observation<sp/>protos<sp/>into<sp/>numpy<sp/>arrays.</highlight></codeline>
<codeline lineno="599"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="600"><highlight class="stringliteral"><sp/><sp/>This<sp/>has<sp/>the<sp/>implementation<sp/>details<sp/>of<sp/>how<sp/>to<sp/>render<sp/>a<sp/>starcraft<sp/>environment.</highlight></codeline>
<codeline lineno="601"><highlight class="stringliteral"><sp/><sp/>It<sp/>translates<sp/>between<sp/>agent<sp/>action/observation<sp/>formats<sp/>and<sp/>starcraft</highlight></codeline>
<codeline lineno="602"><highlight class="stringliteral"><sp/><sp/>action/observation<sp/>formats,<sp/>which<sp/>should<sp/>not<sp/>be<sp/>seen<sp/>by<sp/>agent<sp/>authors.<sp/>The</highlight></codeline>
<codeline lineno="603"><highlight class="stringliteral"><sp/><sp/>starcraft<sp/>protos<sp/>contain<sp/>more<sp/>information<sp/>than<sp/>they<sp/>should<sp/>have<sp/>access<sp/>to.</highlight></codeline>
<codeline lineno="604"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="605"><highlight class="stringliteral"><sp/><sp/>This<sp/>is<sp/>outside<sp/>of<sp/>the<sp/>environment<sp/>so<sp/>that<sp/>it<sp/>can<sp/>also<sp/>be<sp/>used<sp/>in<sp/>other</highlight></codeline>
<codeline lineno="606"><highlight class="stringliteral"><sp/><sp/>contexts,<sp/>eg<sp/>a<sp/>supervised<sp/>dataset<sp/>pipeline.</highlight></codeline>
<codeline lineno="607"><highlight class="stringliteral"><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_features_1af12dfcaae0adbc89c662a44b8ce762de" kindref="member">__init__</ref>(self,<sp/>agent_interface_format=None,<sp/>map_size=None):</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Initialize<sp/>a<sp/>Features<sp/>instance<sp/>matching<sp/>the<sp/>specified<sp/>interface<sp/>format.</highlight></codeline>
<codeline lineno="611"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="612"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="613"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>agent_interface_format:<sp/>See<sp/>the<sp/>documentation<sp/>for<sp/>`AgentInterfaceFormat`.</highlight></codeline>
<codeline lineno="614"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>map_size:<sp/>The<sp/>size<sp/>of<sp/>the<sp/>map<sp/>in<sp/>world<sp/>units,<sp/>needed<sp/>for<sp/>feature_units.</highlight></codeline>
<codeline lineno="615"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="616"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Raises:</highlight></codeline>
<codeline lineno="617"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ValueError:<sp/>if<sp/>agent_interface_format<sp/>isn&apos;t<sp/>specified.</highlight></codeline>
<codeline lineno="618"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ValueError:<sp/>if<sp/>map_size<sp/>isn&apos;t<sp/>specified<sp/>when<sp/>use_feature_units<sp/>is.</highlight></codeline>
<codeline lineno="619"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>agent_interface_format:</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Please<sp/>specify<sp/>agent_interface_format&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="622"><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a0bb37b9909fce8b0589a09769079262f" kindref="member">_agent_interface_format</ref><sp/>=<sp/>agent_interface_format</highlight></codeline>
<codeline lineno="624"><highlight class="normal"></highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>agent_interface_format.use_feature_units:</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a50e1c8ff5b600a9769a7a79b73af181e" kindref="member">_init_camera</ref>(</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>agent_interface_format.feature_dimensions,</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>map_size,</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>agent_interface_format.camera_width_world_units)</highlight></codeline>
<codeline lineno="630"><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a49f6d5fc745e3b57363513852041f56d" kindref="member">_valid_functions</ref><sp/>=<sp/>_init_valid_functions(</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>agent_interface_format.action_dimensions)</highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_init_camera(</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self,<sp/>feature_dimensions,<sp/>map_size,<sp/>camera_width_world_units):</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Initialize<sp/>the<sp/>feature_units<sp/>camera.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>map_size<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>camera_width_world_units:</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Either<sp/>pass<sp/>the<sp/>game_info<sp/>with<sp/>raw<sp/>enabled,<sp/>or<sp/>map_size<sp/>and<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;camera_width_world_units<sp/>in<sp/>order<sp/>to<sp/>use<sp/>feature_units.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/>map_size<sp/>=<sp/>point.Point.build(map_size)</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a03b505e8e3f699667aa93ca09ab153ac" kindref="member">_world_to_world_tl</ref><sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1transform_1_1_linear" kindref="compound">transform.Linear</ref>(<ref refid="classpysc2_1_1lib_1_1point_1_1_point" kindref="compound">point.Point</ref>(1,<sp/>-1),</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classpysc2_1_1lib_1_1point_1_1_point" kindref="compound">point.Point</ref>(0,<sp/>map_size.y))</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ad6796520d6f46e9d9370dcd7b823f1c1" kindref="member">_world_tl_to_world_camera_rel</ref><sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1transform_1_1_linear" kindref="compound">transform.Linear</ref>(offset=-map_size<sp/>/<sp/>4)</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/>world_camera_rel_to_feature_screen<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1transform_1_1_linear" kindref="compound">transform.Linear</ref>(</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>feature_dimensions.screen<sp/>/<sp/>camera_width_world_units,</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>feature_dimensions.screen<sp/>/<sp/>2)</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1abaa5c9f33c4e8d07b16552512f20d3f8" kindref="member">_world_to_feature_screen_px</ref><sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1transform_1_1_chain" kindref="compound">transform.Chain</ref>(</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a03b505e8e3f699667aa93ca09ab153ac" kindref="member">_world_to_world_tl</ref>,</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ad6796520d6f46e9d9370dcd7b823f1c1" kindref="member">_world_tl_to_world_camera_rel</ref>,</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>world_camera_rel_to_feature_screen,</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classpysc2_1_1lib_1_1transform_1_1_pixel_to_coord" kindref="compound">transform.PixelToCoord</ref>())</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_update_camera(self,<sp/>camera_center):</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Update<sp/>the<sp/>camera<sp/>transform<sp/>based<sp/>on<sp/>the<sp/>new<sp/>camera<sp/>center.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ad6796520d6f46e9d9370dcd7b823f1c1" kindref="member">_world_tl_to_world_camera_rel</ref>.offset<sp/>=<sp/>(</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a03b505e8e3f699667aa93ca09ab153ac" kindref="member">_world_to_world_tl</ref>.fwd_pt(camera_center)<sp/>*</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ad6796520d6f46e9d9370dcd7b823f1c1" kindref="member">_world_tl_to_world_camera_rel</ref>.scale)</highlight></codeline>
<codeline lineno="659"><highlight class="normal"></highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a4b1d691f5d9376c1116a6c81a927e865" kindref="member">observation_spec</ref>(self):</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;The<sp/>observation<sp/>spec<sp/>for<sp/>the<sp/>SC2<sp/>environment.</highlight></codeline>
<codeline lineno="662"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="663"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>It&apos;s<sp/>worth<sp/>noting<sp/>that<sp/>the<sp/>image-like<sp/>observations<sp/>are<sp/>in<sp/>y,x/row,column</highlight></codeline>
<codeline lineno="664"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>order<sp/>which<sp/>is<sp/>different<sp/>than<sp/>the<sp/>actions<sp/>which<sp/>are<sp/>in<sp/>x,y<sp/>order.<sp/>This<sp/>is</highlight></codeline>
<codeline lineno="665"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>due<sp/>to<sp/>conflicting<sp/>conventions,<sp/>and<sp/>to<sp/>facilitate<sp/>printing<sp/>of<sp/>the<sp/>images.</highlight></codeline>
<codeline lineno="666"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="667"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Returns:</highlight></codeline>
<codeline lineno="668"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>The<sp/>dict<sp/>of<sp/>observation<sp/>names<sp/>to<sp/>their<sp/>tensor<sp/>shapes.<sp/>Shapes<sp/>with<sp/>a<sp/>0<sp/>can</highlight></codeline>
<codeline lineno="669"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>vary<sp/>in<sp/>length,<sp/>for<sp/>example<sp/>the<sp/>number<sp/>of<sp/>valid<sp/>actions<sp/>depends<sp/>on<sp/>which</highlight></codeline>
<codeline lineno="670"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>units<sp/>you<sp/>have<sp/>selected.</highlight></codeline>
<codeline lineno="671"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/>obs_spec<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_dict" kindref="compound">named_array.NamedDict</ref>({</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;action_result&quot;</highlight><highlight class="normal">:<sp/>(0,),<sp/><sp/></highlight><highlight class="comment">#<sp/>See<sp/>error.proto:<sp/>ActionResult.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;alerts&quot;</highlight><highlight class="normal">:<sp/>(0,),<sp/><sp/></highlight><highlight class="comment">#<sp/>See<sp/>sc2api.proto:<sp/>Alert.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;available_actions&quot;</highlight><highlight class="normal">:<sp/>(0,),</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;build_queue&quot;</highlight><highlight class="normal">:<sp/>(0,<sp/>len(UnitLayer)),<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=wrong-arg-types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;cargo&quot;</highlight><highlight class="normal">:<sp/>(0,<sp/>len(UnitLayer)),<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=wrong-arg-types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;cargo_slots_available&quot;</highlight><highlight class="normal">:<sp/>(1,),</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;control_groups&quot;</highlight><highlight class="normal">:<sp/>(10,<sp/>2),</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;game_loop&quot;</highlight><highlight class="normal">:<sp/>(1,),</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;last_actions&quot;</highlight><highlight class="normal">:<sp/>(0,),</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;multi_select&quot;</highlight><highlight class="normal">:<sp/>(0,<sp/>len(UnitLayer)),<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=wrong-arg-types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;player&quot;</highlight><highlight class="normal">:<sp/>(len(Player),),<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=wrong-arg-types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;score_cumulative&quot;</highlight><highlight class="normal">:<sp/>(len(ScoreCumulative),),<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=wrong-arg-types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;single_select&quot;</highlight><highlight class="normal">:<sp/>(0,<sp/>len(UnitLayer)),<sp/><sp/></highlight><highlight class="comment">#<sp/>Only<sp/>(n,<sp/>7)<sp/>for<sp/>n<sp/>in<sp/>(0,<sp/>1).<sp/><sp/>#<sp/>pytype:<sp/>disable=wrong-arg-types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline lineno="687"><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/>aif<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a0bb37b9909fce8b0589a09769079262f" kindref="member">_agent_interface_format</ref></highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aif.feature_dimensions:</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>obs_spec[</highlight><highlight class="stringliteral">&quot;feature_screen&quot;</highlight><highlight class="normal">]<sp/>=<sp/>(len(SCREEN_FEATURES),</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aif.feature_dimensions.screen.y,</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aif.feature_dimensions.screen.x)</highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>obs_spec[</highlight><highlight class="stringliteral">&quot;feature_minimap&quot;</highlight><highlight class="normal">]<sp/>=<sp/>(len(MINIMAP_FEATURES),</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aif.feature_dimensions.minimap.y,</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aif.feature_dimensions.minimap.x)</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aif.rgb_dimensions:</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>obs_spec[</highlight><highlight class="stringliteral">&quot;rgb_screen&quot;</highlight><highlight class="normal">]<sp/>=<sp/>(aif.rgb_dimensions.screen.y,</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aif.rgb_dimensions.screen.x,</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3)</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>obs_spec[</highlight><highlight class="stringliteral">&quot;rgb_minimap&quot;</highlight><highlight class="normal">]<sp/>=<sp/>(aif.rgb_dimensions.minimap.y,</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aif.rgb_dimensions.minimap.x,</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3)</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aif.use_feature_units:</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>obs_spec[</highlight><highlight class="stringliteral">&quot;feature_units&quot;</highlight><highlight class="normal">]<sp/>=<sp/>(0,<sp/>len(FeatureUnit))<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=wrong-arg-types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>obs_spec</highlight></codeline>
<codeline lineno="708"><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a76e3d8bfc6e588ee9dddbbb34015ca7d" kindref="member">action_spec</ref>(self):</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;The<sp/>action<sp/>space<sp/>pretty<sp/>complicated<sp/>and<sp/>fills<sp/>the<sp/>ValidFunctions.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a49f6d5fc745e3b57363513852041f56d" kindref="member">_valid_functions</ref></highlight></codeline>
<codeline lineno="712"><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a79fe09a0d35b8d7b6f761da2ddc72f67" kindref="member">transform_obs</ref>(self,<sp/>obs):</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Render<sp/>some<sp/>SC2<sp/>observations<sp/>into<sp/>something<sp/>an<sp/>agent<sp/>can<sp/>handle.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/>empty<sp/>=<sp/>np.array([],<sp/>dtype=np.int32).reshape((0,<sp/>7))</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>out<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_dict" kindref="compound">named_array.NamedDict</ref>({<sp/><sp/></highlight><highlight class="comment">#<sp/>Fill<sp/>out<sp/>some<sp/>that<sp/>are<sp/>sometimes<sp/>empty.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;single_select&quot;</highlight><highlight class="normal">:<sp/>empty,</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;multi_select&quot;</highlight><highlight class="normal">:<sp/>empty,</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;build_queue&quot;</highlight><highlight class="normal">:<sp/>empty,</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;cargo&quot;</highlight><highlight class="normal">:<sp/>empty,</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;cargo_slots_available&quot;</highlight><highlight class="normal">:<sp/>np.array([0],<sp/>dtype=np.int32),</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline lineno="724"><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">or_zeros(layer,<sp/>size):</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>layer<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>layer.astype(np.int32,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>np.zeros((size.y,<sp/>size.x),<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="730"><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/>aif<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a0bb37b9909fce8b0589a09769079262f" kindref="member">_agent_interface_format</ref></highlight></codeline>
<codeline lineno="732"><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aif.feature_dimensions:</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;feature_screen&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>np.stack(or_zeros(f.unpack(obs.observation),</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aif.feature_dimensions.screen)</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>f<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>SCREEN_FEATURES),</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>names=[ScreenFeatures,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;feature_minimap&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>np.stack(or_zeros(f.unpack(obs.observation),</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aif.feature_dimensions.minimap)</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>f<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>MINIMAP_FEATURES),</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>names=[MinimapFeatures,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="744"><highlight class="normal"></highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aif.rgb_dimensions:</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;rgb_screen&quot;</highlight><highlight class="normal">]<sp/>=<sp/>Feature.unpack_rgb_image(</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obs.observation.render_data.map).astype(np.int32)</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;rgb_minimap&quot;</highlight><highlight class="normal">]<sp/>=<sp/>Feature.unpack_rgb_image(</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obs.observation.render_data.minimap).astype(np.int32)</highlight></codeline>
<codeline lineno="750"><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;last_actions&quot;</highlight><highlight class="normal">]<sp/>=<sp/>np.array(</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ae50848a35cd3c31833d1eb37662611f3" kindref="member">reverse_action</ref>(a).function<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>a<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>obs.actions],</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="754"><highlight class="normal"></highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;action_result&quot;</highlight><highlight class="normal">]<sp/>=<sp/>np.array([o.result<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>o<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>obs.action_errors],</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="757"><highlight class="normal"></highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;alerts&quot;</highlight><highlight class="normal">]<sp/>=<sp/>np.array(obs.observation.alerts,<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="759"><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;game_loop&quot;</highlight><highlight class="normal">]<sp/>=<sp/>np.array([obs.observation.game_loop],<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/>score_details<sp/>=<sp/>obs.observation.score.score_details</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;score_cumulative&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>([</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>obs.observation.score.score,</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.idle_production_time,</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.idle_worker_time,</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.total_value_units,</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.total_value_structures,</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.killed_value_units,</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.killed_value_structures,</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.collected_minerals,</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.collected_vespene,</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.collection_rate_minerals,</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.collection_rate_vespene,</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.spent_minerals,</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>score_details.spent_vespene,</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/>],<sp/>names=ScoreCumulative,<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="778"><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/>player<sp/>=<sp/>obs.observation.player_common</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;player&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>([</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.player_id,</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.minerals,</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.vespene,</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.food_used,</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.food_cap,</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.food_army,</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.food_workers,</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.idle_worker_count,</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.army_count,</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.warp_gate_count,</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>player.larva_count,</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/>],<sp/>names=Player,<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="793"><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">unit_vec(u):</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>np.array((</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.unit_type,</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.player_relative,</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.health,</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.shields,</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.energy,</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.transport_slots_taken,</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int(u.build_progress<sp/>*<sp/>100),<sp/><sp/></highlight><highlight class="comment">#<sp/>discretize</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="804"><highlight class="normal"></highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/>ui<sp/>=<sp/>obs.observation.ui_data</highlight></codeline>
<codeline lineno="806"><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/>with<sp/><ref refid="namespacepysc2_1_1lib_1_1features_1a062cf1836da62c7466fa1666e71541d3" kindref="member">sw</ref>(</highlight><highlight class="stringliteral">&quot;ui&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>groups<sp/>=<sp/>np.zeros((10,<sp/>2),<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>g<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ui.groups:</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>groups[g.control_group_index,<sp/>:]<sp/>=<sp/>(g.leader_unit_type,<sp/>g.count)</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;control_groups&quot;</highlight><highlight class="normal">]<sp/>=<sp/>groups</highlight></codeline>
<codeline lineno="812"><highlight class="normal"></highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ui.single:</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;single_select&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[unit_vec(ui.single.unit)],<sp/>[</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>UnitLayer])</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ui.multi<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>ui.multi.units:</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;multi_select&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[unit_vec(u)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>u<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ui.multi.units],<sp/>[</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>UnitLayer])</highlight></codeline>
<codeline lineno="820"><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ui.cargo<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>ui.cargo.passengers:</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;single_select&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[unit_vec(ui.single.unit)],<sp/>[</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>UnitLayer])</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;cargo&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[unit_vec(u)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>u<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ui.cargo.passengers],<sp/>[</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>UnitLayer])</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;cargo_slots_available&quot;</highlight><highlight class="normal">]<sp/>=<sp/>np.array([ui.cargo.slots_available],</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="828"><highlight class="normal"></highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ui.production<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>ui.production.build_queue:</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;single_select&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[unit_vec(ui.production.unit)],<sp/>[</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>UnitLayer])</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;build_queue&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[unit_vec(u)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>u<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ui.production.build_queue],</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>UnitLayer])</highlight></codeline>
<codeline lineno="835"><highlight class="normal"></highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">feature_unit_vec(u):</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>screen_pos<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1abaa5c9f33c4e8d07b16552512f20d3f8" kindref="member">_world_to_feature_screen_px</ref>.fwd_pt(</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>point.Point.build(u.pos))</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>screen_radius<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1abaa5c9f33c4e8d07b16552512f20d3f8" kindref="member">_world_to_feature_screen_px</ref>.fwd_dist(u.radius)</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>np.array((</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Match<sp/>unit_vec<sp/>order</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.unit_type,</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.alliance,<sp/><sp/></highlight><highlight class="comment">#<sp/>Self<sp/>=<sp/>1,<sp/>Ally<sp/>=<sp/>2,<sp/>Neutral<sp/>=<sp/>3,<sp/>Enemy<sp/>=<sp/>4</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.health,</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.shield,</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.energy,</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.cargo_space_taken,</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int(u.build_progress<sp/>*<sp/>100),<sp/><sp/></highlight><highlight class="comment">#<sp/>discretize</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="849"><highlight class="normal"></highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Resume<sp/>API<sp/>order</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int(u.health<sp/>/<sp/>u.health_max<sp/>*<sp/>255)<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>u.health_max<sp/>&gt;<sp/>0<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>0,</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int(u.shield<sp/>/<sp/>u.shield_max<sp/>*<sp/>255)<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>u.shield_max<sp/>&gt;<sp/>0<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>0,</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int(u.energy<sp/>/<sp/>u.energy_max<sp/>*<sp/>255)<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>u.energy_max<sp/>&gt;<sp/>0<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>0,</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.display_type,<sp/><sp/></highlight><highlight class="comment">#<sp/>Visible<sp/>=<sp/>1,<sp/>Snapshot<sp/>=<sp/>2,<sp/>Hidden<sp/>=<sp/>3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.owner,<sp/><sp/></highlight><highlight class="comment">#<sp/>1-15,<sp/>16<sp/>=<sp/>neutral</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>screen_pos.x,</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>screen_pos.y,</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.facing,</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>screen_radius,</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.cloak,<sp/><sp/></highlight><highlight class="comment">#<sp/>Cloaked<sp/>=<sp/>1,<sp/>CloakedDetected<sp/>=<sp/>2,<sp/>NotCloaked<sp/>=<sp/>3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.is_selected,</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.is_blip,</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.is_powered,</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.mineral_contents,</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.vespene_contents,</highlight></codeline>
<codeline lineno="866"><highlight class="normal"></highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Not<sp/>populated<sp/>for<sp/>enemies<sp/>or<sp/>neutral</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.cargo_space_max,</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.assigned_harvesters,</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.ideal_harvesters,</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u.weapon_cooldown,</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="873"><highlight class="normal"></highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/>raw<sp/>=<sp/>obs.observation.raw_data</highlight></codeline>
<codeline lineno="875"><highlight class="normal"></highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aif.use_feature_units:</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>with<sp/><ref refid="namespacepysc2_1_1lib_1_1features_1a062cf1836da62c7466fa1666e71541d3" kindref="member">sw</ref>(</highlight><highlight class="stringliteral">&quot;feature_units&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Update<sp/>the<sp/>camera<sp/>location<sp/>so<sp/>we<sp/>can<sp/>calculate<sp/>world<sp/>to<sp/>screen<sp/>pos</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1aa7ad734fa0b8135583714d0be7d765d7" kindref="member">_update_camera</ref>(point.Point.build(raw.player.camera))</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>feature_units<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>u<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>raw.units:</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>u.is_on_screen<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>u.display_type<sp/>!=<sp/>sc_raw.Hidden:</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>feature_units.append(feature_unit_vec(u))</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;feature_units&quot;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="classpysc2_1_1lib_1_1named__array_1_1_named_numpy_array" kindref="compound">named_array.NamedNumpyArray</ref>(</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>feature_units,<sp/>[</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>FeatureUnit],<sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="886"><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/>out[</highlight><highlight class="stringliteral">&quot;available_actions&quot;</highlight><highlight class="normal">]<sp/>=<sp/>np.array(self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ad5a0a4cc33805616b7219e81d5be3d03" kindref="member">available_actions</ref>(obs.observation),</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dtype=np.int32)</highlight></codeline>
<codeline lineno="889"><highlight class="normal"></highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>out</highlight></codeline>
<codeline lineno="891"><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ad5a0a4cc33805616b7219e81d5be3d03" kindref="member">available_actions</ref>(self,<sp/>obs):</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>the<sp/>list<sp/>of<sp/>available<sp/>action<sp/>ids.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/>available_actions<sp/>=<sp/>set()</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/>hide_specific_actions<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a0bb37b9909fce8b0589a09769079262f" kindref="member">_agent_interface_format</ref>.hide_specific_actions</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i,<sp/>func<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>six.iteritems(actions.FUNCTIONS_AVAILABLE):</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>func.avail_fn(obs):</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>available_actions.add(i)</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>a<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>obs.abilities:</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>a.ability_id<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>actions.ABILITY_IDS:</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logging.warning(</highlight><highlight class="stringliteral">&quot;Unknown<sp/>ability<sp/>%s<sp/>seen<sp/>as<sp/>available.&quot;</highlight><highlight class="normal">,<sp/>a.ability_id)</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>func<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>actions.ABILITY_IDS[a.ability_id]:</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>func.function_type<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>actions.POINT_REQUIRED_FUNCS[a.requires_point]:</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>func.general_id<sp/>==<sp/>0<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>hide_specific_actions:</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>available_actions.add(func.id)</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>func.general_id<sp/>!=<sp/>0:<sp/><sp/></highlight><highlight class="comment">#<sp/>Always<sp/>offer<sp/>generic<sp/>actions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>general_func<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>actions.ABILITY_IDS[func.general_id]:</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>general_func.function_type<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/>func.function_type:</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Only<sp/>the<sp/>right<sp/>type.<sp/>Don&apos;t<sp/>want<sp/>to<sp/>expose<sp/>the<sp/>general<sp/>action</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>to<sp/>minimap<sp/>if<sp/>only<sp/>the<sp/>screen<sp/>version<sp/>is<sp/>available.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>available_actions.add(general_func.id)</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>list(available_actions)</highlight></codeline>
<codeline lineno="916"><highlight class="normal"></highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a4d30783f71487ebbf7ac3cf21873af65" kindref="member">transform_action</ref>(self,<sp/>obs,<sp/>func_call,<sp/>skip_available=False):</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Tranform<sp/>an<sp/>agent-style<sp/>action<sp/>to<sp/>one<sp/>that<sp/>SC2<sp/>can<sp/>consume.</highlight></codeline>
<codeline lineno="920"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="921"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="922"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>obs:<sp/>a<sp/>`sc_pb.Observation`<sp/>from<sp/>the<sp/>previous<sp/>frame.</highlight></codeline>
<codeline lineno="923"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>func_call:<sp/>a<sp/>`FunctionCall`<sp/>to<sp/>be<sp/>turned<sp/>into<sp/>a<sp/>`sc_pb.Action`.</highlight></codeline>
<codeline lineno="924"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>skip_available:<sp/>If<sp/>True,<sp/>assume<sp/>the<sp/>action<sp/>is<sp/>available.<sp/>This<sp/>should<sp/>only</highlight></codeline>
<codeline lineno="925"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>be<sp/>used<sp/>for<sp/>testing<sp/>or<sp/>if<sp/>you<sp/>expect<sp/>to<sp/>make<sp/>actions<sp/>that<sp/>weren&apos;t</highlight></codeline>
<codeline lineno="926"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>valid<sp/>at<sp/>the<sp/>last<sp/>observation.</highlight></codeline>
<codeline lineno="927"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="928"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Returns:</highlight></codeline>
<codeline lineno="929"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>corresponding<sp/>`sc_pb.Action`.</highlight></codeline>
<codeline lineno="930"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="931"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Raises:</highlight></codeline>
<codeline lineno="932"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ValueError:<sp/>if<sp/>the<sp/>action<sp/>doesn&apos;t<sp/>pass<sp/>validation.</highlight></codeline>
<codeline lineno="933"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/>func_id<sp/>=<sp/>func_call.function</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>func<sp/>=<sp/>actions.FUNCTIONS[func_id]</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>KeyError:</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>function<sp/>id:<sp/>%s.&quot;</highlight><highlight class="normal"><sp/>%<sp/>func_id)</highlight></codeline>
<codeline lineno="939"><highlight class="normal"></highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Available?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>(skip_available<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>func_id<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ad5a0a4cc33805616b7219e81d5be3d03" kindref="member">available_actions</ref>(obs)):</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Function<sp/>%s/%s<sp/>is<sp/>currently<sp/>not<sp/>available&quot;</highlight><highlight class="normal"><sp/>%<sp/>(</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func_id,<sp/>func.name))</highlight></codeline>
<codeline lineno="944"><highlight class="normal"></highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Right<sp/>number<sp/>of<sp/>args?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(func_call.arguments)<sp/>!=<sp/>len(func.args):</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Wrong<sp/>number<sp/>of<sp/>arguments<sp/>for<sp/>function:<sp/>%s,<sp/>got:<sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>(</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func,<sp/>func_call.arguments))</highlight></codeline>
<codeline lineno="950"><highlight class="normal"></highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Args<sp/>are<sp/>valid?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/>aif<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a0bb37b9909fce8b0589a09769079262f" kindref="member">_agent_interface_format</ref></highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>t,<sp/>arg<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>zip(func.args,<sp/>func_call.arguments):</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>t.name<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&quot;screen&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;screen2&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sizes<sp/>=<sp/>aif.action_dimensions.screen</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>t.name<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;minimap&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sizes<sp/>=<sp/>aif.action_dimensions.minimap</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sizes<sp/>=<sp/>t.sizes</highlight></codeline>
<codeline lineno="960"><highlight class="normal"></highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(sizes)<sp/>!=<sp/>len(arg):</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Wrong<sp/>number<sp/>of<sp/>values<sp/>for<sp/>argument<sp/>of<sp/>%s,<sp/>got:<sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>(</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func,<sp/>func_call.arguments))</highlight></codeline>
<codeline lineno="965"><highlight class="normal"></highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>s,<sp/>a<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>zip(sizes,<sp/>arg):</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>0<sp/>&lt;=<sp/>a<sp/>&lt;<sp/>s:</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Argument<sp/>is<sp/>out<sp/>of<sp/>range<sp/>for<sp/>%s,<sp/>got:<sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>(</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func,<sp/>func_call.arguments))</highlight></codeline>
<codeline lineno="970"><highlight class="normal"></highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Convert<sp/>them<sp/>to<sp/>python<sp/>types.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/>kwargs<sp/>=<sp/>{type_.name:<sp/>type_.fn(a)</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>type_,<sp/>a<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>zip(func.args,<sp/>func_call.arguments)}</highlight></codeline>
<codeline lineno="974"><highlight class="normal"></highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Call<sp/>the<sp/>right<sp/>callback<sp/>to<sp/>get<sp/>an<sp/>SC2<sp/>action<sp/>proto.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/>sc2_action<sp/>=<sp/>sc_pb.Action()</highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/>kwargs[</highlight><highlight class="stringliteral">&quot;action&quot;</highlight><highlight class="normal">]<sp/>=<sp/>sc2_action</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/>kwargs[</highlight><highlight class="stringliteral">&quot;action_space&quot;</highlight><highlight class="normal">]<sp/>=<sp/>aif.action_space</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>func.ability_id:</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>kwargs[</highlight><highlight class="stringliteral">&quot;ability_id&quot;</highlight><highlight class="normal">]<sp/>=<sp/>func.ability_id</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/>actions.FUNCTIONS[func_id].function_type(**kwargs)</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>sc2_action</highlight></codeline>
<codeline lineno="983"><highlight class="normal"></highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1features_1_1_features_1ae50848a35cd3c31833d1eb37662611f3" kindref="member">reverse_action</ref>(self,<sp/>action):</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Transform<sp/>an<sp/>SC2-style<sp/>action<sp/>into<sp/>an<sp/>agent-style<sp/>action.</highlight></codeline>
<codeline lineno="987"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="988"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>This<sp/>should<sp/>be<sp/>the<sp/>inverse<sp/>of<sp/>`transform_action`.</highlight></codeline>
<codeline lineno="989"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="990"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="991"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>action:<sp/>a<sp/>`sc_pb.Action`<sp/>to<sp/>be<sp/>transformed.</highlight></codeline>
<codeline lineno="992"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="993"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Returns:</highlight></codeline>
<codeline lineno="994"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>A<sp/>corresponding<sp/>`actions.FunctionCall`.</highlight></codeline>
<codeline lineno="995"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="996"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Raises:</highlight></codeline>
<codeline lineno="997"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ValueError:<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>know<sp/>how<sp/>to<sp/>transform<sp/>this<sp/>action.</highlight></codeline>
<codeline lineno="998"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/>FUNCTIONS<sp/>=<sp/>actions.FUNCTIONS<sp/><sp/></highlight><highlight class="comment">#<sp/>pylint:<sp/>disable=invalid-name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1000"><highlight class="normal"></highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/>aif<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1features_1_1_features_1a0bb37b9909fce8b0589a09769079262f" kindref="member">_agent_interface_format</ref></highlight></codeline>
<codeline lineno="1002"><highlight class="normal"></highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">func_call_ability(ability_id,<sp/>cmd_type,<sp/>*args):</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Get<sp/>the<sp/>function<sp/>id<sp/>for<sp/>a<sp/>specific<sp/>ability<sp/>id<sp/>and<sp/>action<sp/>type.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ability_id<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>actions.ABILITY_IDS:</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logging.warning(</highlight><highlight class="stringliteral">&quot;Unknown<sp/>ability_id:<sp/>%s.<sp/>This<sp/>is<sp/>probably<sp/>dance<sp/>or<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;cheer,<sp/>or<sp/>some<sp/>unknown<sp/>new<sp/>or<sp/>map<sp/>specific<sp/>ability.<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Treating<sp/>it<sp/>as<sp/>a<sp/>no-op.&quot;</highlight><highlight class="normal">,<sp/>ability_id)</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.no_op()</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"></highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aif.hide_specific_actions:</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>general_id<sp/>=<sp/>next(iter(actions.ABILITY_IDS[ability_id])).general_id</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>general_id:</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ability_id<sp/>=<sp/>general_id</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>func<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>actions.ABILITY_IDS[ability_id]:</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>func.function_type<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/>cmd_type:</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS[func.id](*args)</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Unknown<sp/>ability_id:<sp/>%s,<sp/>type:<sp/>%s.<sp/>Likely<sp/>a<sp/>bug.&quot;</highlight><highlight class="normal"><sp/>%<sp/>(</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ability_id,<sp/>cmd_type.__name__))</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"></highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>action.HasField(</highlight><highlight class="stringliteral">&quot;action_ui&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>act_ui<sp/>=<sp/>action.action_ui</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;multi_panel&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.select_unit(act_ui.multi_panel.type<sp/>-<sp/>1,</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>act_ui.multi_panel.unit_index)</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;control_group&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.select_control_group(</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>act_ui.control_group.action<sp/>-<sp/>1,</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>act_ui.control_group.control_group_index)</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;select_idle_worker&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.select_idle_worker(act_ui.select_idle_worker.type<sp/>-<sp/>1)</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;select_army&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.select_army(act_ui.select_army.selection_add)</highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;select_warp_gates&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.select_warp_gates(</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>act_ui.select_warp_gates.selection_add)</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;select_larva&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.select_larva()</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;cargo_panel&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.unload(act_ui.cargo_panel.unit_index)</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;production_panel&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.build_queue(act_ui.production_panel.unit_index)</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_ui.HasField(</highlight><highlight class="stringliteral">&quot;toggle_autocast&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>func_call_ability(act_ui.toggle_autocast.ability_id,</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>actions.autocast)</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"></highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(action.HasField(</highlight><highlight class="stringliteral">&quot;action_feature_layer&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>action.HasField(</highlight><highlight class="stringliteral">&quot;action_render&quot;</highlight><highlight class="normal">)):</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>act_sp<sp/>=<sp/>actions.spatial(action,<sp/>aif.action_space)</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_sp.HasField(</highlight><highlight class="stringliteral">&quot;camera_move&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coord<sp/>=<sp/>point.Point.build(act_sp.camera_move.center_minimap)</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.move_camera(coord)</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_sp.HasField(</highlight><highlight class="stringliteral">&quot;unit_selection_point&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>select_point<sp/>=<sp/>act_sp.unit_selection_point</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coord<sp/>=<sp/>point.Point.build(select_point.selection_screen_coord)</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.select_point(select_point.type<sp/>-<sp/>1,<sp/>coord)</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_sp.HasField(</highlight><highlight class="stringliteral">&quot;unit_selection_rect&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>select_rect<sp/>=<sp/>act_sp.unit_selection_rect</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>TODO(tewalds):<sp/>After<sp/>looking<sp/>at<sp/>some<sp/>replays<sp/>we<sp/>should<sp/>decide<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>this<sp/>is<sp/>good<sp/>enough.<sp/>Maybe<sp/>we<sp/>need<sp/>to<sp/>simulate<sp/>multiple<sp/>actions<sp/>or</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>merge<sp/>the<sp/>selection<sp/>rects<sp/>into<sp/>a<sp/>bigger<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tl<sp/>=<sp/>point.Point.build(select_rect.selection_screen_coord[0].p0)</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>br<sp/>=<sp/>point.Point.build(select_rect.selection_screen_coord[0].p1)</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.select_rect(select_rect.selection_add,<sp/>tl,<sp/>br)</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>act_sp.HasField(</highlight><highlight class="stringliteral">&quot;unit_command&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmd<sp/>=<sp/>act_sp.unit_command</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>queue<sp/>=<sp/>int(cmd.queue_command)</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>cmd.HasField(</highlight><highlight class="stringliteral">&quot;target_screen_coord&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coord<sp/>=<sp/>point.Point.build(cmd.target_screen_coord)</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>func_call_ability(cmd.ability_id,<sp/>actions.cmd_screen,</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>queue,<sp/>coord)</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>cmd.HasField(</highlight><highlight class="stringliteral">&quot;target_minimap_coord&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>coord<sp/>=<sp/>point.Point.build(cmd.target_minimap_coord)</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>func_call_ability(cmd.ability_id,<sp/>actions.cmd_minimap,</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>queue,<sp/>coord)</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>func_call_ability(cmd.ability_id,<sp/>actions.cmd_quick,<sp/>queue)</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"></highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>action.HasField(</highlight><highlight class="stringliteral">&quot;action_raw&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>action.HasField(</highlight><highlight class="stringliteral">&quot;action_render&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Unknown<sp/>action:\n%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>action)</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"></highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FUNCTIONS.no_op()</highlight></codeline>
    </programlisting>
    <location file="lib/features.py"/>
  </compounddef>
</doxygen>
