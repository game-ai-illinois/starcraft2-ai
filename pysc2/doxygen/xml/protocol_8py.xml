<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.14">
  <compounddef id="protocol_8py" kind="file" language="Python">
    <compoundname>protocol.py</compoundname>
    <innerclass refid="classpysc2_1_1lib_1_1protocol_1_1_connection_error" prot="public">pysc2::lib::protocol::ConnectionError</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1protocol_1_1_protocol_error" prot="public">pysc2::lib::protocol::ProtocolError</innerclass>
    <innerclass refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol" prot="public">pysc2::lib::protocol::StarcraftProtocol</innerclass>
    <innernamespace refid="namespacepysc2_1_1lib_1_1protocol">pysc2::lib::protocol</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacepysc2_1_1lib_1_1protocol" refkind="compound"><highlight class="comment">#<sp/>Copyright<sp/>2017<sp/>Google<sp/>Inc.<sp/>All<sp/>Rights<sp/>Reserved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Licensed<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the<sp/>&quot;License&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">#<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance<sp/>with<sp/>the<sp/>License.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">#<sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Unless<sp/>required<sp/>by<sp/>applicable<sp/>law<sp/>or<sp/>agreed<sp/>to<sp/>in<sp/>writing,<sp/>software</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">#<sp/>distributed<sp/>under<sp/>the<sp/>License<sp/>is<sp/>distributed<sp/>on<sp/>an<sp/>&quot;AS-IS&quot;<sp/>BASIS,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">#<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY<sp/>KIND,<sp/>either<sp/>express<sp/>or<sp/>implied.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">#<sp/>See<sp/>the<sp/>License<sp/>for<sp/>the<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">#<sp/>limitations<sp/>under<sp/>the<sp/>License.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="stringliteral">&quot;&quot;&quot;Protocol<sp/>library<sp/>to<sp/>make<sp/>communication<sp/>easy.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>absolute_import</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>division</highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>print_function</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>contextlib</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>absl<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logging</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>os</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>socket</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sys</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>time</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>absl<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>flags</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>enum</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacepysc2_1_1lib" kindref="compound">pysc2.lib</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>stopwatch</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>websocket</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>s2clientprotocol<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sc2api_pb2<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>sc_pb</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal">flags.DEFINE_integer(</highlight><highlight class="stringliteral">&quot;sc2_verbose_protocol&quot;</highlight><highlight class="normal">,<sp/>0,</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="stringliteral">&quot;Print<sp/>the<sp/>communication<sp/>packets<sp/>with<sp/>SC2.<sp/>0<sp/>disables.<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;-1<sp/>means<sp/>all.<sp/>&gt;0<sp/>will<sp/>print<sp/>that<sp/>many<sp/>lines<sp/>per<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;packet.<sp/>20<sp/>is<sp/>a<sp/>good<sp/>starting<sp/>value.&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="39"><highlight class="normal">FLAGS<sp/>=<sp/>flags.FLAGS</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal">sw<sp/>=<sp/>stopwatch.sw</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Create<sp/>a<sp/>python<sp/>version<sp/>of<sp/>the<sp/>Status<sp/>enum<sp/>in<sp/>the<sp/>proto.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal">Status<sp/>=<sp/>enum.Enum(</highlight><highlight class="stringliteral">&quot;Status&quot;</highlight><highlight class="normal">,<sp/>sc_pb.Status.items())<sp/><sp/></highlight><highlight class="comment">#<sp/>pylint:<sp/>disable=invalid-name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48" refid="classpysc2_1_1lib_1_1protocol_1_1_connection_error" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_connection_error" kindref="compound">ConnectionError</ref>(Exception):</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Failed<sp/>to<sp/>read/write<sp/>a<sp/>message,<sp/>details<sp/>in<sp/>the<sp/>error<sp/>string.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">pass</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53" refid="classpysc2_1_1lib_1_1protocol_1_1_protocol_error" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_protocol_error" kindref="compound">ProtocolError</ref>(Exception):</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;SC2<sp/>responded<sp/>with<sp/>an<sp/>error<sp/>message<sp/>likely<sp/>due<sp/>to<sp/>a<sp/>bad<sp/>request<sp/>or<sp/>bug.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">pass</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal">@contextlib.contextmanager</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacepysc2_1_1lib_1_1protocol_1a9dc3f36956ad7b672f9910dc3d7fac62" kindref="member">catch_websocket_connection_errors</ref>():</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;A<sp/>context<sp/>manager<sp/>that<sp/>translates<sp/>websocket<sp/>errors<sp/>into<sp/>ConnectionError.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">yield</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>websocket.WebSocketConnectionClosedException:</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1protocol_1_1_connection_error" kindref="compound">ConnectionError</ref>(</highlight><highlight class="stringliteral">&quot;Connection<sp/>already<sp/>closed.<sp/>SC2<sp/>probably<sp/>crashed.<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Check<sp/>the<sp/>error<sp/>log.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>websocket.WebSocketTimeoutException:</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1protocol_1_1_connection_error" kindref="compound">ConnectionError</ref>(</highlight><highlight class="stringliteral">&quot;Websocket<sp/>timed<sp/>out.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>socket.error<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1protocol_1_1_connection_error" kindref="compound">ConnectionError</ref>(</highlight><highlight class="stringliteral">&quot;Socket<sp/>error:<sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>e)</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72" refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol" kindref="compound">StarcraftProtocol</ref>(object):</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Defines<sp/>the<sp/>protocol<sp/>for<sp/>chatting<sp/>with<sp/>starcraft.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a65fca7cc64f33165f660c46142568895" kindref="member">__init__</ref>(self,<sp/>sock):</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a647783ef9b0fbe60d79e85c3bbd83000" kindref="member">_status</ref><sp/>=<sp/>Status.launched</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a47cfeda9f8082fc1c5a7801bbf22f151" kindref="member">_sock</ref><sp/>=<sp/>sock</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/>@property</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a0dce2570a5feaa1da6e3d282fc2ea83a" kindref="member">status</ref>(self):</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a647783ef9b0fbe60d79e85c3bbd83000" kindref="member">_status</ref></highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a0388e8e80a71a4a63a000bc52ec92653" kindref="member">close</ref>(self):</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a47cfeda9f8082fc1c5a7801bbf22f151" kindref="member">_sock</ref>:</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a47cfeda9f8082fc1c5a7801bbf22f151" kindref="member">_sock</ref>.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a0388e8e80a71a4a63a000bc52ec92653" kindref="member">close</ref>()</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a47cfeda9f8082fc1c5a7801bbf22f151" kindref="member">_sock</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a647783ef9b0fbe60d79e85c3bbd83000" kindref="member">_status</ref><sp/>=<sp/>Status.quit</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a7633ee8d525381b124b9c09017e2d50d" kindref="member">read</ref>(self):</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Read<sp/>a<sp/>Response,<sp/>do<sp/>some<sp/>validation,<sp/>and<sp/>return<sp/>it.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>FLAGS.sc2_verbose_protocol:</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a910f0a3a6c33d1f9cf929385198c8eb4" kindref="member">_log</ref>(</highlight><highlight class="stringliteral">&quot;<sp/>Reading<sp/>response<sp/>&quot;</highlight><highlight class="normal">.center(60,<sp/></highlight><highlight class="stringliteral">&quot;-&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>start<sp/>=<sp/>time.time()</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>response<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1acf35697729dfff564189241c945bdb06" kindref="member">_read</ref>()</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>FLAGS.sc2_verbose_protocol:</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a910f0a3a6c33d1f9cf929385198c8eb4" kindref="member">_log</ref>(</highlight><highlight class="stringliteral">&quot;<sp/>%0.1f<sp/>msec\n&quot;</highlight><highlight class="normal"><sp/>%<sp/>(1000<sp/>*<sp/>(time.time()<sp/>-<sp/>start)))</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a1574ccb43767ca4aab8ecf4af7d9aafc" kindref="member">_log_packet</ref>(response)</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>response.HasField(</highlight><highlight class="stringliteral">&quot;status&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1protocol_1_1_protocol_error" kindref="compound">ProtocolError</ref>(</highlight><highlight class="stringliteral">&quot;Got<sp/>an<sp/>incomplete<sp/>response<sp/>without<sp/>a<sp/>status.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>prev_status<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a647783ef9b0fbe60d79e85c3bbd83000" kindref="member">_status</ref></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a647783ef9b0fbe60d79e85c3bbd83000" kindref="member">_status</ref><sp/>=<sp/><ref refid="namespacepysc2_1_1lib_1_1protocol_1adfe00ba6b54424ee04479b5340d49293" kindref="member">Status</ref>(response.status)<sp/><sp/></highlight><highlight class="comment">#<sp/>pytype:<sp/>disable=not-callable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>response.error:</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>err_str<sp/>=<sp/>(</highlight><highlight class="stringliteral">&quot;Error<sp/>in<sp/>RPC<sp/>response<sp/>(likely<sp/>a<sp/>bug).<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Prev<sp/>status:<sp/>%s,<sp/>new<sp/>status:<sp/>%s,<sp/>error:\n%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>(</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prev_status,<sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a647783ef9b0fbe60d79e85c3bbd83000" kindref="member">_status</ref>,<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">.join(response.error)))</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>logging.error(err_str)</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1protocol_1_1_protocol_error" kindref="compound">ProtocolError</ref>(err_str)</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>response</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/>@sw.decorate</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a03ee4d6020768e77fd68d290ffa423a5" kindref="member">write</ref>(self,<sp/>request):</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Write<sp/>a<sp/>Request.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>FLAGS.sc2_verbose_protocol:</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a910f0a3a6c33d1f9cf929385198c8eb4" kindref="member">_log</ref>(</highlight><highlight class="stringliteral">&quot;<sp/>Writing<sp/>request<sp/>&quot;</highlight><highlight class="normal">.center(60,<sp/></highlight><highlight class="stringliteral">&quot;-&quot;</highlight><highlight class="normal">)<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a1574ccb43767ca4aab8ecf4af7d9aafc" kindref="member">_log_packet</ref>(request)</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a3b1e64be1a18c5b6a7ee7957001d318a" kindref="member">_write</ref>(request)</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a12f0a3837aad92c813ca60416dcc6a89" kindref="member">send_req</ref>(self,<sp/>request):</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Write<sp/>a<sp/>pre-filled<sp/>Request<sp/>and<sp/>return<sp/>the<sp/>Response.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a03ee4d6020768e77fd68d290ffa423a5" kindref="member">write</ref>(request)</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a7633ee8d525381b124b9c09017e2d50d" kindref="member">read</ref>()</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1aac34f8adc8d90d432394760daa65beda" kindref="member">send</ref>(self,<sp/>**kwargs):</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Create<sp/>and<sp/>send<sp/>a<sp/>specific<sp/>request,<sp/>and<sp/>return<sp/>the<sp/>response.</highlight></codeline>
<codeline lineno="126"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="127"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>For<sp/>example:<sp/>send(ping=sc_pb.RequestPing())<sp/>=&gt;<sp/>sc_pb.ResponsePing</highlight></codeline>
<codeline lineno="128"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="129"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Args:</highlight></codeline>
<codeline lineno="130"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>**kwargs:<sp/>A<sp/>single<sp/>kwarg<sp/>with<sp/>the<sp/>name<sp/>and<sp/>value<sp/>to<sp/>fill<sp/>in<sp/>to<sp/>Request.</highlight></codeline>
<codeline lineno="131"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="132"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Returns:</highlight></codeline>
<codeline lineno="133"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>The<sp/>Response<sp/>corresponding<sp/>to<sp/>your<sp/>request.</highlight></codeline>
<codeline lineno="134"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(kwargs)<sp/>==<sp/>1,<sp/></highlight><highlight class="stringliteral">&quot;Must<sp/>make<sp/>a<sp/>single<sp/>request.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/>res<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a12f0a3837aad92c813ca60416dcc6a89" kindref="member">send_req</ref>(sc_pb.Request(**kwargs))</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>getattr(res,<sp/>list(kwargs.keys())[0])</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_log_packet(self,<sp/>packet):</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/>max_lines<sp/>=<sp/>FLAGS.sc2_verbose_protocol</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>max_lines<sp/>&gt;<sp/>0:</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>max_width<sp/>=<sp/>int(os.getenv(</highlight><highlight class="stringliteral">&quot;COLUMNS&quot;</highlight><highlight class="normal">,<sp/>200))<sp/><sp/></highlight><highlight class="comment">#<sp/>Get<sp/>your<sp/>TTY<sp/>width.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>lines<sp/>=<sp/>str(packet).strip().split(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a910f0a3a6c33d1f9cf929385198c8eb4" kindref="member">_log</ref>(</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">.join(line[:max_width]<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>lines[:max_lines]))</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(lines)<sp/>&gt;<sp/>max_lines:</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a910f0a3a6c33d1f9cf929385198c8eb4" kindref="member">_log</ref>((</highlight><highlight class="stringliteral">&quot;****<sp/>%s<sp/>lines<sp/>skipped<sp/>****\n&quot;</highlight><highlight class="normal"><sp/>%<sp/>(len(lines)<sp/>-<sp/>max_lines)))</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a910f0a3a6c33d1f9cf929385198c8eb4" kindref="member">_log</ref>(</highlight><highlight class="stringliteral">&quot;%s\n&quot;</highlight><highlight class="normal"><sp/>%<sp/>packet)</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_log(self,<sp/>s):</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">r&quot;&quot;&quot;Log<sp/>a<sp/>string.<sp/>It<sp/>flushes<sp/>but<sp/>doesn&apos;t<sp/>append<sp/>\n,<sp/>so<sp/>do<sp/>that<sp/>yourself.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>TODO(tewalds):<sp/>Should<sp/>this<sp/>be<sp/>using<sp/>logging.info<sp/>instead?<sp/>How<sp/>to<sp/>see<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>outside<sp/>of<sp/>google<sp/>infrastructure?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>sys.stderr.write(s)</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>sys.stderr.flush()</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_read(self):</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Actually<sp/>read<sp/>the<sp/>response<sp/>and<sp/>parse<sp/>it,<sp/>returning<sp/>a<sp/>Response.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/>with<sp/><ref refid="namespacepysc2_1_1lib_1_1protocol_1a8612b29bdee56dc470fda95c8bbd8cb2" kindref="member">sw</ref>(</highlight><highlight class="stringliteral">&quot;read_response&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>with<sp/><ref refid="namespacepysc2_1_1lib_1_1protocol_1a9dc3f36956ad7b672f9910dc3d7fac62" kindref="member">catch_websocket_connection_errors</ref>():</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>response_str<sp/>=<sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a47cfeda9f8082fc1c5a7801bbf22f151" kindref="member">_sock</ref>.recv()</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>response_str:</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classpysc2_1_1lib_1_1protocol_1_1_protocol_error" kindref="compound">ProtocolError</ref>(</highlight><highlight class="stringliteral">&quot;Got<sp/>an<sp/>empty<sp/>response<sp/>from<sp/>SC2.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>response<sp/>=<sp/>sc_pb.Response()</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/>with<sp/><ref refid="namespacepysc2_1_1lib_1_1protocol_1a8612b29bdee56dc470fda95c8bbd8cb2" kindref="member">sw</ref>(</highlight><highlight class="stringliteral">&quot;parse_response&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>response.ParseFromString(response_str)</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>response</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_write(self,<sp/>request):</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Actually<sp/>serialize<sp/>and<sp/>write<sp/>the<sp/>request.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>with<sp/><ref refid="namespacepysc2_1_1lib_1_1protocol_1a8612b29bdee56dc470fda95c8bbd8cb2" kindref="member">sw</ref>(</highlight><highlight class="stringliteral">&quot;serialize_request&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>request_str<sp/>=<sp/>request.SerializeToString()</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>with<sp/><ref refid="namespacepysc2_1_1lib_1_1protocol_1a8612b29bdee56dc470fda95c8bbd8cb2" kindref="member">sw</ref>(</highlight><highlight class="stringliteral">&quot;write_request&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>with<sp/><ref refid="namespacepysc2_1_1lib_1_1protocol_1a9dc3f36956ad7b672f9910dc3d7fac62" kindref="member">catch_websocket_connection_errors</ref>():</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1a47cfeda9f8082fc1c5a7801bbf22f151" kindref="member">_sock</ref>.<ref refid="classpysc2_1_1lib_1_1protocol_1_1_starcraft_protocol_1aac34f8adc8d90d432394760daa65beda" kindref="member">send</ref>(request_str)</highlight></codeline>
    </programlisting>
    <location file="lib/protocol.py"/>
  </compounddef>
</doxygen>
